# AppNet 应用配置文件
# 用于定义所有反向代理的应用

# ============================================
# 配置参数说明
# ============================================
#
# caddy: Caddy服务器全局配置
#   http_port: Caddy监听端口（默认8880）
#   admin_port: Caddy管理API端口（默认2019，仅本机访问）
#   auto_https: 是否自动启用HTTPS（true/false）
#
# default_redirect: 根路径默认跳转地址
#
# apps: 应用列表
#   - name: 应用名称（唯一标识）
#     type: 应用类型
#       - fullstack: 前后端分离（自动创建backend/frontend）
#       - monolith: 单体应用（Node.js/npm）
#       - custom: 自定义启动脚本
#       - proxy: 代理外部服务
#       - redirect: 跳转到外部URL
#     enabled: 是否启用（true/false，可选，默认true）
#     description: 应用描述
#     start_script: 自定义启动脚本路径（仅custom类型需要）
#     env: 环境变量（可选）
#       VAR_NAME: value
#     routes: 路由配置列表
#       - path: URL路径
#         target: 目标地址（localhost:端口 或 外部URL）
#         type: 路由类型
#           - api: API接口（路径会被精确匹配）
#           - frontend: 前端应用
#           - full: 完整应用
#         strip_prefix: 是否剥离路径前缀（true/false）
#
# 端口分配建议：
#   - 后端服务：使用 28xxx 端口
#   - 前端服务：使用 28xxx+2 端口（前后端分离时）
#   - 单体应用：使用 28xxx 端口
# ============================================

# Caddy 全局配置
caddy:
  http_port: 8880
  admin_port: 2019
  auto_https: false

# Landing Page 配置
landing:
  enabled: true
  path: /home/bio/manage/appnet/landing

# 应用列表
apps:
  # Demo1 - 前后端分离示例（基因表达分析）
  - name: demo1
    type: fullstack
    description: "Gene Expression Analysis - Full Stack Demo"
    routes:
      - path: /demo1/api
        target: localhost:28881
        type: api
        strip_prefix: true
      - path: /demo1
        target: localhost:28883
        type: frontend
        strip_prefix: true

  # Demo2 - 单体应用示例（生存分析）
  - name: demo2
    type: monolith
    description: "Survival Analysis - Monolithic Demo"
    routes:
      - path: /demo2
        target: localhost:28882
        type: full
        strip_prefix: true

  # OTK API - 自定义启动脚本的Python应用
  - name: otk
    type: custom
    description: "OTK Prediction API (Python/FastAPI)"
    start_script: otk_api/start_api.sh
    env:
      API_PORT: 28884
      OTK_BASE_PATH: /otk
    routes:
      - path: /otk
        target: localhost:28884
        type: full
        strip_prefix: false

  # Shiny Server - 跳转到外部地址
  - name: shiny
    type: redirect
    description: "Shiny Server"
    routes:
      - path: /shiny
        target: http://biotree.top:38124/
        type: redirect

  # 示例：如何禁用应用（保留配置但暂时不用）
  # - name: oldapp
  #   type: monolith
  #   enabled: false
  #   description: "Disabled application example"
  #   routes:
  #     - path: /oldapp
  #       target: localhost:28000
  #       type: full
